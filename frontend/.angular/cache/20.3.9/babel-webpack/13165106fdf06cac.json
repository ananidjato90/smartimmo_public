{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { PropertyCardComponent } from '../../components/property-card/property-card.component';\nimport { SearchFiltersComponent } from '../../components/search-filters/search-filters.component';\nimport { AiAssistantPanelComponent } from '../../components/ai-assistant-panel/ai-assistant-panel.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"../../services/ai-agent.service\";\nimport * as i3 from \"@angular/material/snack-bar\";\nimport * as i4 from \"@angular/common\";\nfunction HomePageComponent_app_property_card_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-property-card\", 9);\n    i0.ɵɵlistener(\"favoriteToggle\", function HomePageComponent_app_property_card_7_Template_app_property_card_favoriteToggle_0_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.toggleFavorite($event));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const property_r4 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"property\", property_r4)(\"isFavorite\", ctx_r2.favorites.has(property_r4.id));\n  }\n}\nexport let HomePageComponent = /*#__PURE__*/(() => {\n  class HomePageComponent {\n    constructor(api, ai, snackBar) {\n      this.api = api;\n      this.ai = ai;\n      this.snackBar = snackBar;\n      this.properties = [];\n      this.filters = {};\n      this.favorites = new Set();\n      this.loadProperties();\n      this.loadFavorites();\n    }\n    loadProperties() {\n      this.api.getProperties(this.filters).subscribe({\n        next: properties => {\n          this.properties = properties;\n        },\n        error: () => {\n          this.snackBar.open('Impossible de charger les propriétés', 'Fermer', {\n            duration: 3000\n          });\n        }\n      });\n    }\n    loadFavorites() {\n      this.api.listFavorites().subscribe({\n        next: favorites => {\n          this.favorites = new Set(favorites.map(fav => fav.property.id));\n        },\n        error: () => {\n          this.favorites.clear();\n        }\n      });\n    }\n    onFiltersChange(filters) {\n      this.filters = filters;\n      this.loadProperties();\n    }\n    toggleFavorite(property) {\n      const isFavorite = this.favorites.has(property.id);\n      const request = isFavorite ? this.api.removeFavorite(property.id) : this.api.addFavorite(property.id);\n      request.subscribe({\n        next: () => {\n          if (isFavorite) {\n            this.favorites.delete(property.id);\n            this.snackBar.open('Retiré des favoris', undefined, {\n              duration: 2000\n            });\n          } else {\n            this.favorites.add(property.id);\n            this.snackBar.open('Ajouté aux favoris', undefined, {\n              duration: 2000\n            });\n          }\n        },\n        error: () => {\n          this.snackBar.open('Action indisponible. Vérifiez votre session.', 'Fermer', {\n            duration: 3000\n          });\n        }\n      });\n    }\n    handleAgentQuery(component, prompt) {\n      component.setLoading(true);\n      this.ai.ask(prompt).subscribe({\n        next: res => component.setResponse(res.response),\n        error: () => {\n          component.setResponse(\"L'assistant est indisponible pour le moment.\");\n          this.snackBar.open(\"Erreur lors de la consultation de l'assistant\", 'Fermer', {\n            duration: 3000\n          });\n        }\n      });\n    }\n    static {\n      this.ɵfac = function HomePageComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || HomePageComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.AiAgentService), i0.ɵɵdirectiveInject(i3.MatSnackBar));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: HomePageComponent,\n        selectors: [[\"app-home-page\"]],\n        decls: 11,\n        vars: 1,\n        consts: [[\"assistant\", \"\"], [1, \"home-grid\"], [1, \"left\"], [3, \"filterChange\"], [1, \"properties\"], [1, \"property-grid\"], [3, \"property\", \"isFavorite\", \"favoriteToggle\", 4, \"ngFor\", \"ngForOf\"], [1, \"right\"], [3, \"query\"], [3, \"favoriteToggle\", \"property\", \"isFavorite\"]],\n        template: function HomePageComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"app-search-filters\", 3);\n            i0.ɵɵlistener(\"filterChange\", function HomePageComponent_Template_app_search_filters_filterChange_2_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.onFiltersChange($event));\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"section\", 4)(4, \"h2\");\n            i0.ɵɵtext(5, \"Propri?t?s disponibles\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"div\", 5);\n            i0.ɵɵtemplate(7, HomePageComponent_app_property_card_7_Template, 1, 2, \"app-property-card\", 6);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(8, \"div\", 7)(9, \"app-ai-assistant-panel\", 8, 0);\n            i0.ɵɵlistener(\"query\", function HomePageComponent_Template_app_ai_assistant_panel_query_9_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              const assistant_r5 = i0.ɵɵreference(10);\n              return i0.ɵɵresetView(ctx.handleAgentQuery(assistant_r5, $event));\n            });\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(7);\n            i0.ɵɵproperty(\"ngForOf\", ctx.properties);\n          }\n        },\n        dependencies: [CommonModule, i4.NgForOf, MatSnackBarModule, PropertyCardComponent, SearchFiltersComponent, AiAssistantPanelComponent],\n        styles: [\".home-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:1.5rem}.property-grid[_ngcontent-%COMP%]{display:grid;gap:1.5rem;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));margin-top:1rem}@media (max-width: 1024px){.home-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}\"]\n      });\n    }\n  }\n  return HomePageComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}